# 9.4 Write a program to read through the mbox-short.txt and figure out
# who has sent the greatest number of mail messages.
# The program looks for 'From ' lines and takes the second word of those lines as the person who sent the mail.
# The program creates a Python dictionary that maps the sender's mail address to a count of the number of times they
# appear in the file. After the dictionary is produced, the program reads through the dictionary using a maximum loop
# to find the most prolific committer.

# Summary of Changes:
# - Refactored the input handling using a while loop to avoid redundant code.
# - Fixed string interpolation errors in the exception message.
# - Replaced manual string stripping with the more efficient 'strip' method.
# - Removed unnecessary print statements for debugging.

while True:
    try:
        name = input("Enter file name: ")
        if len(name) < 1:
            name = 'py4e_assignments/8-lists/mbox-short.txt'

        email_addresses = dict()

        with open(name) as handle:
            for line in handle:
                if not line.startswith('From '):
                    continue
                email_address = line.strip().split()[1]
                email_addresses[email_address] = email_addresses.get(email_address, 0) + 1

        most_emails_sent = -1
        email_that_sent_most = None

        for email_address, number_of_emails_sent in email_addresses.items():
            if number_of_emails_sent > most_emails_sent:
                most_emails_sent = number_of_emails_sent
                email_that_sent_most = email_address

        print(f"{email_that_sent_most} sent the most emails: {most_emails_sent}")

        break
    except FileNotFoundError:
        print("File not found. Please enter a valid file path.")